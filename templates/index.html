<!DOCTYPE html>
<html>
<head>
    <title>Find Places</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f0f0f0;
        }
        #results {
            margin-top: 20px;
        }
        .restaurant {
            margin-bottom: 10px;
        }
        .viewport {
            margin-top: 20px;
        }
        .opinion-buttons {
            margin-top: 10px;
        }
        .opinion-buttons button {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <header>
        <h1>Find Nearby Restaurants</h1>
        <nav>
            <!-- Conditional links based on user authentication status -->
            {% if current_user.is_authenticated %}
                <a href="/logout">Logout</a>
            {% else %}
                <a href="/login">Login</a>
                <a href="/register">Register</a>
            {% endif %}
        </nav>
    </header>
    <form id="locationForm">
        <label for="location">Enter location:</label>
        <input type="text" id="location" name="location">
        <br><br>
        <label for="radius">Enter radius (in meters):</label>
        <input type="number" id="radius" name="radius" min="0">
        <br><br>
        <button type="submit">Find</button>
    </form>
    <div id="results"></div>
    <div id="viewport"></div>

    <script>
        document.getElementById('locationForm').addEventListener('submit', function(event) {
            event.preventDefault();
            const location = document.getElementById('location').value;
            const radius = document.getElementById('radius').value;

            fetch('/find_places', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `location=${encodeURIComponent(location)}&radius=${encodeURIComponent(radius)}`
            })
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('results');
                const viewportDiv = document.getElementById('viewport');
                resultsDiv.innerHTML = '';
                viewportDiv.innerHTML = '';

                if (data.error) {
                    resultsDiv.innerHTML = `<p>${data.error}</p>`;
                } else {
                    data.restaurants.forEach(restaurant => {
                        const restaurantDiv = document.createElement('div');
                        restaurantDiv.classList.add('restaurant');
                        restaurantDiv.innerHTML = `
                            <strong>${restaurant.name}</strong><br>
                            Address: ${restaurant.address}<br>
                            Rating: ${restaurant.rating}<br>
                            Open Now: ${restaurant.open_now}<br>
                            Total Ratings: ${restaurant.total_ratings}<br>
                            <div class="opinion-buttons">
                                <button onclick="submitOpinion(${restaurant.id}, 'like')">Like</button>
                                <button onclick="submitOpinion(${restaurant.id}, 'dislike')">Dislike</button>
                                <button onclick="submitOpinion(${restaurant.id}, 'no_opinion')">No Opinion</button>
                            </div>
                        `;
                        resultsDiv.appendChild(restaurantDiv);
                    });

                    const viewportDivContent = `
                        <strong>Viewport</strong><br>
                        Northeast: (${data.viewport.northeast.lat}, ${data.viewport.northeast.lng})<br>
                        Southwest: (${data.viewport.southwest.lat}, ${data.viewport.southwest.lng})
                    `;
                    viewportDiv.innerHTML = viewportDivContent;
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        });

        function submitOpinion(restaurantId, opinion) {
            fetch('/opinion', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: `restaurant_id=${restaurantId}&opinion=${opinion}`
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    alert('Opinion submitted successfully!');
                } else {
                    alert('Error submitting opinion.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>
    <br><br>
    <a href="/top_restaurants">View Top Restaurants</a>
</body>
</html>